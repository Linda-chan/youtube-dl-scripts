<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
                      "http://www.w3c.org/TR/REC-html40/strict.dtd">
<html lang="ru">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="Линда Кайе. Посвящается Ариэль" name="Author">
    <meta content="AJPapps - Spawn HTML file" name="Generator">
    <meta content="ANPFile" name="ProgId">
    <meta content="width=device-width, initial-scale=1" name="Viewport">
    <meta content="---" name="Description">
    
    <title>youtube-dl Scripts</title>
    
    <style type="text/css">
    <!--
      body {
        font:12pt "Trebuchet MS",Tahoma,Arial,sans-serif;
      }
      pre, code {
        font:12pt Consolas,"Courier New",monospace;
      }
      pre {
        margin-left:20px;
      }
      img {
        border:none;
      }
    -->
    </style>
  </head>
  <body>
    
<h1 id="youtube-dl-scripts">youtube-dl Scripts</h1>

<p>Эти скрипты предназначены для запуска <a href="http://youtube-dl.org">youtube-dl</a> с некоторыми полезными параметрами. Разделение идёт по качеству запрашиваемого видео и использованию прокси.</p>

<p>Так же доступны варианты скриптов для форков программы <a href="https://github.com/yt-dlp/yt-dlp">yt-dlp</a> и <a href="https://github.com/ytdl-patched/ytdl-patched">ytdl-patched</a>. По большей части они идентичны оригинальным скриптам и добавляют разве что новый функционал, которого не было в youtube-dl. Поэтому дальше все версии программы будут называться одним словом – «youtube-dl».</p>

<p>Все скрипты представлены в двух версиях: BAT файлы для Windows и скрипты для Bash (Linux и тому подобное). В основном они идентичны, но Windows версия ориентирована на портабельность. Вот несколько отличий:</p>

<ul>
  <li>
    <p>Windows версия ищет файл youtube-dl.exe в каталоге с BAT файлом, в то время как Linux версия считает, что youtube-dl установлен где-то в системе.</p>
  </li>
  <li>
    <p>Windows версия ищет <a href="https://ffmpeg.zeranoe.com/builds/win32/static/">ffmpeg</a> в каталоге с BAT файлом (точнее, «ffmpeg\bin»), в то время как Linux версия считает, что ffmpeg установлен где-то в системе.</p>
  </li>
  <li>
    <p>Windows версия ищет <a href="http://atomicparsley.sourceforge.net">AtomicParsley</a> в каталоге с BAT файлом (точнее, «AtomicParsley»), в то время как Linux версия считает, что AtomicParsley установлен где-то в системе.</p>
  </li>
</ul>

<p>При запуске скрипта переменная HOME переписывается каталогом скрипта. Таким образом файл «<a href="https://github.com/rg3/youtube-dl#authentication-with-netrc-file">.netrc</a>» (с логинами и паролями) берётся из каталога скрипта. То же относится и к каталогу «.cache», который создаётся при скачке видео с YouTube – для его размещения переписывается переменная XDG_CACHE_HOME.</p>

<p>Обратите внимание, что Linux версия скрипта использует команду readlink для получения каталога скрипта. Таким образом использование симлинков на файлы скриптом становится невозможным – скрипт всегда будет устанавливать в HOME каталог оригинального файла, а не симлинка. В Windows такой проблемы нет.</p>

<h2 id="section">Прокси</h2>

<p>Настройки прокси берутся из системы. В Windows это – настройки Internet Explorer («Свойства обозревателя» или что-то такое в Панели управления), в Linux – переменная HTTP_PROXY (и сопутствующие). Если в системе прокси не определён, то соединение производится напрямую.</p>

<h2 id="section-1">Пользовательский конфиг</h2>

<p>При запуске скрипт ищет файл «youtube-dl.cfg» в каталоге скрипта. Если такой файл обнаруживается, он назначается конфигом для youtube-dl. Из него программа берёт дополнительные параметры как если бы они были переданы через командную строку.</p>

<p>Например, его содержимое может быть таким:</p>

<pre><code>--write-description
--write-info-json
--write-annotations
</code></pre>

<h2 id="section-2">Формат имени файла скрипта</h2>

<p>Имя файла скрипта выглядит примерно так:</p>

<blockquote>
  <p>youtube-dl-XX-YY.ZZ</p>
</blockquote>

<p>Где:</p>

<ul>
  <li>
    <p>XX – вариант прокси:</p>

    <ul>
      <li><strong>np</strong> – прямое соединение.</li>
      <li><strong>prx</strong> – системный прокси.</li>
    </ul>
  </li>
  <li>
    <p>YY – качество видео, можно воспринимать как «степень сжатия» (подробности – ниже):</p>

    <ul>
      <li><strong>c0</strong> – лучшее.</li>
      <li><strong>c1</strong> – похуже.</li>
      <li><strong>c5</strong> – среднее.</li>
      <li><strong>c9</strong> – худшее.</li>
      <li><strong>cZ</strong> – определяется пользователем.</li>
      <li><strong>ytcombo</strong> – такой вариант скрипта вызывает другие (за исключением «audio»), пытаясь скачать видео во всех трёх вариантах качества от худшего до лучшего. Применяется для YouTube.</li>
      <li><strong>audio</strong> – извлечение аудио. Программа попытается скачать аудиофайл лучшего качества, а если это не получится, то видеофайл со звуковой дорожкой лучшего качества. В итоговый файл данные конвертируются при помощи ffmpeg. Если он отсутствует, программа оставит то, что прислал сервер.</li>
      <li><strong>formats</strong> – такой вариант скрипта просто показывает список доступных для скачки форматов, ни чего не качая.</li>
      <li><strong>update</strong> – особый случай. Этот файл ничего не качает, а просто пытается обновить youtube-dl до последней версии и создаёт файл youtube-dl.txt со справкой по параметрам программы.</li>
    </ul>
  </li>
  <li>
    <p>ZZ – расширение:</p>

    <ul>
      <li><strong>bat</strong> – Windows BAT файл.</li>
      <li><strong>sh</strong> – Bash скрипт.</li>
    </ul>
  </li>
</ul>

<p>Например:</p>

<blockquote>
  <p>youtube-dl-prx-c9.bat</p>
</blockquote>

<p>BAT файл для Windows, качающий видео худшего качества через прокси.</p>

<h2 id="section-3">Качество видео</h2>

<h3 id="c0">c0</h3>

<p>В этом режиме качество не указывается совсем, и youtube-dl собирает видео из лучших форматов (например, HD видео без звука и HD аудио без изображения), а не выбирает уже готовый формат.</p>

<h3 id="c1">c1</h3>

<p>youtube-dl автоматически выбирает лучшее качество из того, что предложит сервер. На YouTube обычно это – MP4. На других серверах может быть по-разному.</p>

<p>В предыдущих версиях скрипта этот режим назывался «c0».</p>

<h3 id="c5">c5</h3>

<p>Этот вариант основывается на предположении, что видео среднего качества имеет разрешение 360 пикселей по вертикали. Таким образом скрипт запрашивает не определённое качество (лучшее/худшее), а формат 360p или меньше, если такого нет.</p>

<p>В предыдущих версиях скрипта в этом варианте запрашивался формат Webm, который, как правило, содержал видео в 360p. Так же этот вариант работал только на YouTube. Но из-за каких-то изменений на самом YouTube, формат Webm теперь может содержать лучшее качество для некоторых видеороликов. Поэтому теперь скрипт ориентируется не на формат, а на максимальное разрешение. Возможно, теперь он будет полезен и на других видеосервисах.</p>

<h3 id="c9">c9</h3>

<p>youtube-dl автоматически выбирает худшее качество из того, что предложит сервер. На YouTube обычно это – 3gp (для старых мобильных телефонов). На других серверах может быть по-разному.</p>

<p><strong>Внимание!</strong> На серверах, отличных от YouTube, худшего качества может не быть (ролик может быть в одном варианте вообще), и youtube-dl скачает то, что есть. Тем, что есть может оказаться то же видео в HD качестве.</p>

<p>Так же на серверах отличных от YouTube худшее качество может быть в том же формате, что и лучшее, например, в MP4. Поэтому файлы обоих вариантов будут иметь одинаковое имя.</p>

<p>Будьте бдительны!</p>

<h3 id="cz">cZ</h3>

<p>В этом варианте формат видео выбирает сам пользователь. Его нужно передать первым аргументом скрипта в виде кода формата, который можно подсмотреть в первой колонке («Format code») таблички, которую показывает <strong>formats</strong> версия скриптов.</p>

<p>Так же можно указать общие значения, такие как «best», «worst», «mp4», «bestaudio/best» и так далее. Подробности смотрите в документации к youtube-dl, параметр «&#8211;format».</p>

<p>Указанный пользователям формат применяется ко всем URL в командной строке или файле списка. Если такого формата для очередного видео не окажется, youtube-dl пропустит его и перейдёт к следующему URL.</p>

<h2 id="description">Обновление описаний в Descript.ion</h2>

<p>Данные скрипты настроены на сохранение предпросмотров к видео в JPG файлах, а так же некоторых свойств видео в альтернативных потоках NTFS в Windows и расширенных атрибутах (xattr) в Linux. Одно из таких свойств имеет имя <strong>user.xdg.referrer.url</strong> и содержит URL исходного видео.</p>

<p>Я написала <a href="https://github.com/Linda-chan/xdgreferrer-to-description">скрипт</a> для Windows, который красиво извлекает эти адреса и записывает их в Descript.ion.</p>

<p>Проще всего его использовать через локальный конфиг (см. выше). Для этого в файл youtube-dl.cfg следует записать что-то вроде такого:</p>

<pre><code>--exec 'CScript.EXE //NoLogo "C:\Scripts\XdgReferrer To Description\XdgReferrerToDescription.WSF" /jpg {}'
</code></pre>

<p>Ключ «/jpg» сохранит описание и для файла предпросмотра, если такой будет.</p>

<h2 id="section-4">Скрипты для форков</h2>

<p>Как было сказано выше, имеются варианты скриптов для yt-dlp и ytdl-patched. Это форки оригинальной программы, которые появились из-за заморозки разработки оригинальной версии программы. Похоже, они обратно совместимы с youtube-dl, но привносят некоторые нововведения, из которых данные скрипты используют пока только сохранение разбивки видео на главы. Так же они больше не требуют AtomicParsley для работы с предпросмотрами.</p>

<h3 id="yt-dlp">yt-dlp</h3>

<p>В Windows используется x64 екзешник программы – «yt-dlp.exe». При необходимости использования других вариантов (например, «yt-dlp_x86.exe») придётся править BAT файлы ручками.</p>

<h3 id="ytdl-patched">ytdl-patched</h3>

<p>В Windows используется екзешник программы с красной иконкой – «ytdl-patched-red.exe». При необходимости использования варианта с белой иконкой («ytdl-patched-white.exe») или любыми другими иконками, которые нарисует разработчик, придётся править BAT файлы ручками.</p>

<h2 id="section-5">История изменений</h2>

<ul>
  <li>
    <p>23.07.2017</p>

    <ul>
      <li>[+] В подсказку по использованию добавлен пример с ключами «-a» и «&#8211;batch-file». Сама поддержка уже была в скриптах по причине передачи всех парметров BAT и sh файлов программе.</li>
      <li>[+] Теперь появился нормальный ченджлог. Предыдущие изменения можно выяснить разве что только из истории коммитов.</li>
    </ul>
  </li>
  <li>
    <p>27.08.2017</p>

    <ul>
      <li>[+] Появилась поддержка пользовательского конфига в Windows.</li>
    </ul>
  </li>
  <li>
    <p>24.06.2018</p>

    <ul>
      <li>[-] Пофиксила уйму кавычек в sh файлах.</li>
      <li>[+] Появилась поддержка пользовательского конфига в Linux.</li>
      <li>[-] При отсутствии файла .netrc, больше не ругаются ни Bash, ни youtube-dl.</li>
    </ul>
  </li>
  <li>
    <p>23.08.2018</p>

    <ul>
      <li>[+] с5 версия скриптов теперь запрашивает не Webm, а 360p.</li>
    </ul>
  </li>
  <li>
    <p>26.02.2023</p>

    <ul>
      <li>[+] Появились варианты скриптов для yt-dlp и ytdl-patched.</li>
      <li>[+] Изменился смысл с0 версии скриптов.</li>
      <li>[+] Старые с0 версии скриптов переименованы в c1.</li>
    </ul>
  </li>
</ul>

<h2 id="section-6">Маленький копирайт</h2>

<ol>
  <li>
    <p>Программа и исходный код распространяются бесплатно.</p>
  </li>
  <li>
    <p>Вы имеете право распространять их на тех же условиях.</p>
  </li>
  <li>
    <p>Вы не имеете права использовать имя автора после модификации исходного кода.</p>
  </li>
  <li>
    <p>При этом желательно указывать ссылку на автора оригинальной версии исходного кода.</p>
  </li>
  <li>
    <p>Вы не имеете права на платное распространение исходного кода, а также программных модулей, содержащих данный исходнй код.</p>
  </li>
  <li>
    <p>Программа и исходный код распространяются как есть. Автор не несёт ответственности за любые трагедии или несчастные случаи, вызванные использованием программы и исходного кода.</p>
  </li>
  <li>
    <p>Для любого пункта данного соглашения может быть сделано исключение с разрешения автора программы.</p>
  </li>
  <li>
    <p>По любым вопросам, связанным с данной программой, обращайтесь по адресу lindaoneesama@gmail.com</p>
  </li>
</ol>

    
  </body>
</html>
